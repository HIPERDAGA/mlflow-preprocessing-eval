# -*- coding: utf-8 -*-
"""piqe_metric

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1NLuOFDUQYyNejbR-O_uGTgTHq-RMP959
"""

# -*- coding: utf-8 -*-
import numpy as np

# PIQE vÃ­a pyiqa para simplicidad
try:
    import pyiqa
    _PIQE = pyiqa.create_metric('piqe', device='cpu')
except Exception as e:
    _PIQE = None
    _IMPORT_ERR = e

def calculate_piqe(img_rgb: np.ndarray) -> float:
    """
    Calcula PIQE (No-Reference) usando pyiqa.
    - img_rgb: imagen en RGB (0-255, uint8) o (0-1, float)
    Retorna: float (menor es mejor)
    """
    if _PIQE is None:
        raise RuntimeError(
            f"No se pudo inicializar PIQE (pyiqa). Instala con `pip install pyiqa`. Error: {_IMPORT_ERR}"
        )
    import torch
    img = img_rgb.astype(np.float32)
    if img.max() > 1.0:
        img = img / 255.0
    chw = torch.from_numpy(img).permute(2, 0, 1).unsqueeze(0)  # 1xCxHxW
    score = _PIQE(chw).item()
    return float(score)